<!DOCTYPE html>
<html lang="en" x-data="ownerApp()" x-init="init()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OWNER DASHBOARD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-100 font-sans min-h-screen">
  <header class="bg-white p-6 shadow">
    <h1 class="text-3xl font-bold uppercase">OWNER DASHBOARD</h1>
  </header>

  <nav class="bg-white mt-4 mx-auto px-6 py-4 rounded-lg shadow w-full md:max-w-5xl flex space-x-4 uppercase">
    <button @click="tab='today'"  :class="tab==='today' ? 'border-b-2 border-indigo-500' : ''">TODAY'S TASKS</button>
    <button @click="tab='active'" :class="tab==='active'? 'border-b-2 border-indigo-500':''">ACTIVE TASKS</button>
    <button @click="tab='done'"   :class="tab==='done'?   'border-b-2 border-indigo-500':''">TASKS DONE</button>
  </nav>

  <main class="mt-6 mx-auto w-full md:max-w-5xl p-4">
    <!-- TODAY -->
    <section x-show="tab==='today'" x-transition>
      <template x-for="(jobs, emp) in data.today" :key="emp">
        <div class="mb-6">
          <h2 class="text-2xl font-semibold uppercase" x-text="emp"></h2>
          <template x-for="job in jobs" :key="job.id">
            <div class="bg-white p-4 rounded-lg shadow mb-2">
              <div class="flex justify-between">
                <div>
                  <h4 class="font-bold uppercase" x-text="job.name"></h4>
                  <p x-text="job.description"></p>
                </div>
                <p class="text-sm uppercase">Deadline: <span x-text="job.deadline"></span></p>
              </div>
            </div>
          </template>
        </div>
      </template>
    </section>

    <!-- ACTIVE -->
    <section x-show="tab==='active'" x-transition>
      <template x-for="(jobs, emp) in data.active" :key="emp">
        <div class="mb-6">
          <h2 class="text-2xl font-semibold uppercase" x-text="emp"></h2>
          <template x-for="job in jobs" :key="job.id">
            <div class="bg-white p-4 rounded-lg shadow mb-2">
              <div class="flex justify-between">
                <div>
                  <h4 class="font-bold uppercase" x-text="job.name"></h4>
                  <p x-text="job.description"></p>
                </div>
                <div class="text-right space-y-1">
                  <p class="text-sm uppercase">Deadline: <span x-text="job.deadline"></span></p>
                  <label class="text-sm uppercase">PAYMENT</label>
                  <span x-text="job.payment"></span>
                </div>
              </div>
            </div>
          </template>
        </div>
      </template>
    </section>

    <!-- DONE -->
    <section x-show="tab==='done'" x-transition>
      <template x-for="(jobs, emp) in data.done" :key="emp">
        <div class="mb-6">
          <h2 class="text-2xl font-semibold uppercase" x-text="emp"></h2>
          <template x-for="job in jobs" :key="job.id">
            <div class="bg-white p-4 rounded-lg shadow mb-2">
              <div class="flex justify-between">
                <span class="font-bold uppercase" x-text="job.name"></span>
                <p class="text-sm uppercase">Done on: <span x-text="job.timestamp.slice(0,10)"></span></p>
              </div>
              <p x-text="job.description"></p>
            </div>
          </template>
        </div>
      </template>
    </section>
  </main>

  <script>
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbx8AG9ktOqPbvKeM6mRlqIEOYh4ouGLHGjQWt8hNHnh0_xwV-HYPpFbW-ng2j8C7PEZ/exec';

    function ownerApp(){
      return {
        tab: 'today',
        data: { today:{}, active:{}, done:{} },

        init(){
          this.fetchAll();
          setInterval(()=>this.fetchAll(),5000);
        },

        fetchAll(){
          fetch(SHEET_URL)
            .then(r=>r.json())
            .then(rows=>{
              const g={ today:{}, active:{}, done:{} };
              rows.forEach(r=>{
                const sec=r.section;
                if(!g[sec][r.employee]) g[sec][r.employee]=[];
                g[sec][r.employee].push(r);
              });
              this.data=g;
            });
        }
      }
    }
  </script>
</body>
</html>
